# 車両損傷AI評価システム

## 作成者情報
- **氏名**: Hoàng Kim Vĩnh（ホアン・キム・ヴィン）
- **学籍番号**: 20235876
- **大学**: ハノイ工科大学（HUST）

## プロジェクト概要

YOLOv11nを使用した包括的なコンピュータビジョンパイプラインによる、自動車両損傷の検出、セグメンテーション、重要度評価システムです。このシステムは、AI駆動画像処理による車両損傷分析のエンドツーエンドソリューションを提供し、高精度なリアルタイム検出機能を実現しています。

### 実装済み主要機能
- **物体検出**: YOLOv11nを使用した車両損傷の局在化
- **インスタンスセグメンテーション**: 精密な損傷マスクの生成
- **重要度推定**: 損傷重要度レベルの分類・回帰
- **包括的評価**: mAP、IoU、精度メトリクス
- **堅牢性分析**: 撮影角度と完全性による性能評価
- **インタラクティブWebデモ**: リアルタイム推論と可視化

## 使用技術

### バックエンド
- **Python 3.11**: AIモデル開発のメインプログラミング言語
- **PyTorch**: モデル訓練と推論のためのディープラーニングフレームワーク
- **Ultralytics YOLOv11n**: 最先端の物体検出・セグメンテーションモデル
  - *選択理由*: 精度と推論速度の優れたバランス、リアルタイムアプリケーションに最適
- **OpenCV**: 画像処理のためのコンピュータビジョンライブラリ
- **NumPy & Pandas**: データ操作と数値計算
- **Streamlit**: デモインターフェース用のWebアプリケーションフレームワーク
  - *選択理由*: 迅速なプロトタイピングと最小限のコードでのMLモデルの簡単なデプロイ

### フロントエンド（Webインターフェース）
- **Streamlit**: インタラクティブWebアプリケーションフレームワーク
- **Plotly**: チャートとグラフのためのインタラクティブ可視化ライブラリ
- **PIL (Python Imaging Library)**: 画像処理と表示
- **Base64エンコーディング**: Webインターフェースでの画像データ転送と表示

### データ処理・評価
- **COCOデータセット形式**: 物体検出の標準アノテーション形式
- **YOLO形式変換**: カスタム前処理パイプライン
- **JSON/YAML**: 設定とメタデータの保存
- **Matplotlib/Seaborn**: データ可視化と分析

### モデル訓練・最適化
- **CUDA**: 訓練用GPU加速（利用可能な場合）
- **Weights & Biases統合**: 実験追跡と監視
- **モデルチェックポイント**: 訓練中の最良モデルの自動保存

## プロジェクト構造

### バックエンドコンポーネント
```
Sun-Car-Damage-AI-Assessment/
├── 📁 scripts/                              # コアAIパイプラインスクリプト
│   ├── coco_data_preprocessing.py           # データ前処理と変換
│   ├── train_yolov11n.py                    # モデル訓練パイプライン
│   └── evaluate_models.py                   # モデル評価とメトリクス
├── 📁 models/                               # 訓練済みモデル成果物
│   ├── 📁 detection/                        # 物体検出モデル
│   ├── 📁 segmentation/                     # インスタンスセグメンテーションモデル
│   └── 📁 exports/                          # ONNX出力モデル
├── 📁 evaluation/                           # 評価フレームワーク
│   ├── metrics.py                           # カスタムメトリクス実装
│   └── 📁 reports/                          # 性能分析レポート
├── 📁 configs/                              # 設定管理
│   ├── training_config.yaml                # 訓練ハイパーパラメータ
│   ├── model_config.yaml                   # モデルアーキテクチャ設定
│   └── evaluation_config.yaml              # 評価パラメータ
└── main.py                                  # メイン実行エントリーポイント
```

### フロントエンドコンポーネント
```
├── 📁 app/                                  # Webアプリケーションインターフェース
│   ├── streamlit_app.py                    # メインStreamlitアプリケーション
│   └── requirements.txt                    # フロントエンド依存関係
├── 📁 screenshots/                         # デモスクリーンショットと動画
│   ├── Demo_web.mp4                        # アプリケーションデモ動画
│   └── image.png                           # インターフェーススクリーンショット
├── run_app.bat                             # Windowsアプリケーションランチャー
└── run_app.sh                              # Unix/Linuxアプリケーションランチャー
```

### データ管理
```
├── 📁 data/                                 # データセット保存と管理
│   └── 📁 CarDD_COCO/                      # 元のCOCO形式データセット
│       ├── 📁 annotations/                 # アノテーションファイル（JSON）
│       ├── 📁 CarDD-TR/                    # 訓練画像（3000+）
│       ├── 📁 CarDD-VAL/                   # 検証画像（800+）
│       └── 📁 CarDD-TE/                    # テスト画像（800+）
├── 📁 yolo_dataset/                        # 処理済みYOLO形式データ
│   ├── 📁 train/, 📁 val/, 📁 test/        # 画像とラベルの分割データセット
│   ├── dataset.yaml                        # YOLO設定
│   └── 📁 analysis/                        # データセット分析結果
└── 📁 runs/                                # 訓練実験ログ
```

### 🏷️ 損傷クラスマッピング

YOLOデータセットは車両損傷検出のために以下のクラスマッピングを使用します：

| クラスID | 損傷タイプ | 説明 | カラーコード |
|----------|-------------|-------------|------------|
| 0 | **へこみ** | 塗装損傷のない表面変形 | 🟦 青 |
| 1 | **傷** | 表面塗装損傷と傷 | 🟩 緑 |
| 2 | **ひび割れ** | ボディパネルやバンパーのひび | 🟡 黄 |
| 3 | **ガラス** | フロントガラスや窓の損傷 | 🟣 紫 |
| 4 | **破損** | 重度の衝撃損傷 | 🟠 オレンジ |
| 5 | **隙間** | パネルのギャップと位置ずれ問題 | 🔴 赤 |

### 📊 データセット統計

分析されたサンプルラベルファイルに基づく：

- **マルチクラス画像**: 多くの画像に複数の損傷タイプが含まれる
- **密なアノテーション**: 8-12のバウンディングボックスを持つ複雑な損傷シーン
- **損傷分布**: 
  - へこみ（クラス0）: 最も一般的な損傷タイプ
  - 傷（クラス1）: へこみと頻繁に併発
  - 破損（クラス4）: しばしば他の損傷タイプと一緒に現れる
  - ガラス（クラス3）: 頻度は低いが安全評価に重要
- **アノテーション形式**: 正規化座標によるYOLO形式
  - `class_id x_center y_center width height`

## 機能

### データパイプライン
- COCOからYOLO形式への変換
- マルチモーダル処理（元画像、エッジ、マスク画像）
- 損傷面積からの自動重要度推定
- 包括的なデータセット分析と可視化

### モデル訓練
- 検出とセグメンテーションのためのYOLOv11n
- 高度な拡張と最適化
- マルチメトリクス評価（mAP@0.5、mAP@0.5:0.95、IoU）
- メタデータ属性による堅牢性分析

### Webインターフェース
- リアルタイム損傷検出と可視化
- インタラクティブマスクオーバーレイと信頼度調整
- 損傷重要度評価とレポート
- JSON/PNG形式での結果出力

### 評価・分析
- カテゴリ別性能メトリクス
- 撮影角度と完全性による堅牢性テスト
- 失敗ケース分析と可視化
- 自動レポート生成

## モデル性能

|   モデル  |    タスク   | mAP@0.5 | mAP@0.5:0.95 | 推論時間 |
|----------|-----------|---------|--------------|----------------|
| YOLOv11n | 検出 | 0.7357  |    0.5833    | 34 ms          |

## データセット情報

- **総画像数**: 訓練、検証、テスト分割
- **損傷カテゴリ**: 様々なタイプの車両損傷
- **アノテーション**: バウンディングボックスとセグメンテーションマスク
- **メタデータ**: 撮影角度、完全性、重要度レベル

## 引用

この研究を使用する場合は、以下を引用してください：
```bibtex
@software{car_damage_ai_assessment,
  title={Car Damage AI Assessment System},
  author={Hoàng Kim Vĩnh},
  year={2025},
  url={https://github.com/CatKod/Sun-Car-Damage-AI-Assessment}
}
```
